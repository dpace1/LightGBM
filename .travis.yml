language: cpp
sudo: required
dist: trusty

compiler:
  - gcc

matrix:
  include:
    - os: linux
      env: TASK=regular
    - os: linux
      env: TASK=mpi
    - os: linux
      env: TASK=gpu
    - os: linux
      env: TASK=pip
    - os: linux
      env: TASK=pylint
    - os: linux
      env: TASK=if-else
    - os: osx
      env: TASK=regular
    - os: osx
      env: TASK=mpi
    - os: osx
      env: TASK=pip

before_install:
- test -n $CC  && unset CC
- test -n $CXX && unset CXX

install:
- bash .travis/setup.sh
- bash conda.sh -b -p $HOME/miniconda
- export PATH="$HOME/miniconda/bin:$PATH"
- conda config --set always_yes yes --set changeps1 no
- conda update -q conda

script:
- bash .travis/test.sh

notifications:
  email: false

deploy:
  provider: releases
  api-key:
    secure: "m9avpV4QDei8Gce9GUd0u25YbzNQvh+s80oSqmW4jHUyG1qU1G4EiIsxJb6Ah8AVXoGBpivBHWMQAYLjV9uJIGfLi+ktv7p3A9MxjwqBR/xn1hikz3S6NkHoX5+0/PJQRMZe6x5GbbbuEuZWPdu828oVpTABmum1UEHFWXNtPw7z5WBdpdC+XyNxKGpjo/XSxeyCAxHkr7Rt8XFHVsGUcB2gLgV4SeNzdpu+K5KgPIKC9YzaICkEgDN0Pab2IcgmrzuVRKTU3Q35EOWCIQ14subWp4IsptMpqqr7qA+2OUfRfSAY8WBeqqxY5iYU986hJDf/Ig1fjLzfrsnuNBwnV11xf7MgCXlPkRY0OjRbT2fxPh0znweHi4eP7AuQlamiGxwu9JsB0q+ojSNHqO1IVIFFParaPKKCRiaEPjWdTFa0GbLHrAVhyKPTsEIAbRR33PoQGusQh2NJTaXzGcyLAJ9KPaXaGMcpUsmIhXoA8kukAoXVrb4DXhXEeHe0h413v/EDevMuprgePJARckLU0W1kTstL+7lh5wdvsqYUQuLysyHIzE5iyyOC0Q+2ma9WOWwiNQaAJfWLuDkUL7g/HZrePVNY4u9y2nkkys8GogNAi2egYB6W6MNnVY2og2YDHQYbDbm+EoZ17TBjUmZzwGre5OW7xsJb526XZpDyPVI="
  file_glob: true
  file: python-package/dist/*.whl
  skip_cleanup: true
  on:
    condition: "$TASK = pip"
    tags: true
    all_branches: true
